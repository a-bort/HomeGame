extends layout

block content
    script(type="text/javascript" src="/javascripts/controllers/joinGameController.js")
    div(ng-controller="JoinGameController" ng-init="initWithGame(#{JSON.stringify(game)}, #{JSON.stringify(userAttending)}, #{JSON.stringify(autoJoin)}, #{JSON.stringify(user)})")
        div(ng-if="activeGame")
          div.row
            div.col-md-12
              h2.content-head Game Info
          div.row
            div.col-md-6
              div.game-grid
                div.game-grid-subhead {{activeGame.owner.displayName}}'s {{activeGame.stakes}}, {{activeGame.gameType}} {{activeGame.gameFormat}}
                div
                  span.strong-text When:
                  |{{activeGame.dateString}} @ {{activeGame.timeString}}
                div
                  span.strong-text Where:
                  | {{activeGame.location}}
                div.info-body.multi-line {{activeGame.notes}}
                div(ng-show="!activeGame.pastGame")
                  button.pure-button.pure-button-primary#join-button(ng-click="join()" ng-disabled="userAttending") {{joinButtonText()}}
                  button.pure-button.pure-button-primary#cancel-button(ng-click="cancel()" ng-show="userAttending") Cancel Reservation
                  div(style="float: right;")
                    a.small-text.strong-text(href="#", onclick="$('#friend-instructions').show()") Want to invite a friend?
                    div#friend-instructions.small-text(style="display: none") Simply send them the url of this page. However, know that the game owner can kick them if they so choose.  
                div(ng-show="activeGame.pastGame")
                  button.pure-button.button-error(disabled="true") Registration Closed              
              div.game-grid
                div.game-grid-subhead Comments
                div.small-text(ng-hide="userAttending") Join this game to add a comment
                div.row(ng-show="userAttending")
                  div.col-md-9.push-md
                    span.roster-image
                      img(ng-src="{{currentUser.imageUrl}}")
                    span
                      textarea(style="vertical-align: top; width: 75%; height: 50px; resize: vertical;", ng-model="$parent.commentText")
                  div.col-md-3.push-md
                    button.pure-button.button-info(ng-click="comment()") Post
                hr(ng-show="activeGame.comments.length > 0")
                table.comment-table
                  tr(ng-repeat="comment in activeGame.comments")
                    td.roster-image.push-md
                      img(ng-src="{{comment.user.imageUrl}}")
                    td
                      div.small-text.grey-text(style="line-height: 14px;") {{comment.dateString}}
                      div {{comment.text}}
                    td
                      button.pure-button.button-plain.button-xsmall(style="padding-bottom: 8px;")
                        span.glyphicon.glyphicon-remove
            div.col-md-6
              div.game-grid
                div.game-grid-subhead Current Roster ({{activeGame.emptySeats}}&nbsp;/&nbsp;{{activeGame.seats}} Seats Remaining)
                div.roster-seat(ng-repeat="seat in activeGame.seatCollection | filter:filledSeatFilter")
                  div.roster-image
                    img(ng-src="{{seat.user.imageUrl}}")
                  div.roster-name {{seat.user.displayName}}
                    button.pure-button.button-error.button-xsmall.left-lg(ng-hide="!currentUserIsOwner || seat.user._id == currentUserId || activeGame.pastGame", ng-click="kick(seat.user._id)") X
              div.game-grid(ng-hide="emptySeats()")
                div.game-grid-subhead Waitlist
                div(ng-visible="activeGame.waitListCollection.length == 0") The waitlist is empty
                div.roster-seat(ng-repeat="seat in activeGame.waitListCollection | orderBy: 'created'")
                  div.roster-image
                    img(ng-src="{{seat.user.imageUrl}}")
                  div.roster-name {{seat.user.displayName}}
              div.game-grid(ng-show="currentUserIsOwner && anyAddablePlayers()")
                div.game-grid-subhead Add Players from Player Pool
                div.roster-seat(ng-repeat="player in currentUser.playerPool | filter:addablePlayer")
                  div.roster-image
                    img(ng-src="{{player.user.imageUrl}}")
                  div.roster-name {{player.user.displayName}}
                    button.pure-button.button-success.button-xsmall.left-lg(ng-click="add(player.user._id)", style="padding-bottom: 8px;")
                      span.glyphicon.glyphicon-plus
                  
